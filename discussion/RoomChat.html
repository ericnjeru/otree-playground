{{block styles}}
<link rel="stylesheet" href="{{static 'chat.css'}}"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"/>
{{ endblock }}

{{ block content }}


<div class="container">
    <div class="row clearfix">
        <div class="col-lg-12">
            <div class="card chat-app">
                <div class="chat">
                    <div class="chat-header clearfix">
                        <div class="row">
                            <div class="col-lg-6">
                                <a href="javascript:void(0);" data-toggle="modal" data-target="#view_info">
                                    <img src="{{static 'discussion.svg'}}" alt="avatar">
                                </a>
                                <div class="chat-about">
                                    <h6 class="m-b-0">Otree Discussion: session '{{group.session.code}}'</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-history bg-dark text-white">
                        <ul class="m-b-0" id="chat-list">


                        </ul>
                    </div>
                    <div class="chat-message clearfix">
                        <div class="input-group input-group-lg mb-0">
                            <div class="input-group-prepend">
                                <span class="input-group-text h-100">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                         class="bi bi-send" viewBox="0 0 16 16">
                                      <path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"/>
                                    </svg>
                                </span>
                            </div>
                           <input type="text" class="form-control" id="new-message" placeholder="Type message here...">

                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let chatList = document.getElementById('chat-list');
    let newMessageInput = document.getElementById('new-message');

    function addPost() {
        // let title = titleInput.value.trim();
        let content = newMessageInput.value.trim();
        if (content === "") {
            alert("Message is required!");
            return;
        }

        liveSend({'type': 'add', 'message': content});
    }

    newMessageInput.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
            addPost();
        }
    });

    function makePostsLayout(posts) {
        chatList.innerHTML = '';
        let row = ''
        if (posts?.length === 0) {
            row = `  <p class="text-center">Messages will appear here</p>`;
            chatList.insertAdjacentHTML('beforeend', row)
        } else {
            console.log(posts)
            for (let post of posts) {
                if (post.player_id === js_vars.player_id) {
                    row = `
                        <li class="clearfix">
                            <div class="message-data">
                                <span class="message-data-time">
                                 <b>You</b>: ${post.created_at}</span>
                            </div>
                            <div class="message my-message"> ${post.content} </div>
                        </li>

                    `;
                } else {
                    row = `
                       <li class="clearfix">
                            <div class="message-data text-right justify-content-end d-flex">
                                <span class="message-data-time">
                                <b>${post.player_name}</b>: ${post.created_at}
                                </span>
                            </div>
                            <div class="message other-message float-right"> ${post.content} </div>
                        </li>
            `;
                }

                chatList.insertAdjacentHTML('beforeend', row)
            }
        }

    }

    function liveRecv(data) {
        makePostsLayout(data?.posts)
    }

    document.addEventListener("DOMContentLoaded", function (event) {
        liveSend({'type': 'load'});
    });
</script>


{{ endblock }}
